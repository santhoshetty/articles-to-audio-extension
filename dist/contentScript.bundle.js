(()=>{console.log("\u{1F4F0} Article Extractor Initialized");chrome.runtime.onMessage.addListener((l,c,s)=>{if(console.log("Message received in content script:",l),l.action==="EXTRACT_ARTICLE")return d().then(i=>{console.log("Extracted article data:",i),s(i)}),!0});async function d(){if(!(await chrome.storage.local.get(["openaiKey"])).openaiKey)throw new Error("OpenAI API key not found. Please set it in the extension options.");function c(t){if(!t)return"";let n=t.cloneNode(!0);return n.querySelectorAll("script, style, nav, header, footer, .ad, .advertisement").forEach(r=>r.remove()),n.innerText.trim()}function s(){let t=[];return document.querySelectorAll("iframe").forEach(n=>{try{let o=n.getAttribute("src");if(o&&o.includes("disqus.com")){console.warn("Skipping Disqus iframe due to cross-origin restrictions.");return}let r=n.contentDocument||n.contentWindow.document;if(r){let a=r.querySelector(".article-list-article, article, .article-content");if(a)t.push(c(a));else{let u=c(r.body);u.length>100&&t.push(u)}}}catch(o){console.warn("Could not access iframe:",o)}}),t.join(`

`)}let i=[".article-list-article","article",".article-content",".story-content",'div[class*="article"]','div[class*="story"]',".entry-content","main",'div[role="main"]'],e="";for(let t of i){let n=document.querySelector(t);if(n){if(e=c(n),console.log(`Found content using selector: ${t}, Content Length: ${e.length}`),e.length>100){console.log(`Valid content found: ${e.slice(0,200)}...`);break}}else console.log(`No content found for selector: ${t}`)}if((!e||e.length<100)&&(console.log("Checking iframes for content..."),e=s(),console.log(`Iframes content length: ${e.length}`)),!e.trim())throw new Error("No article content found. Please make sure you're on an article page.");return console.log("Content extraction stats:",{totalLength:e.length,preview:e.slice(0,200)+"...",estimatedTokens:Math.ceil(e.length/4)}),{title:document.title,text:e}}})();
