(()=>{console.log("\u{1F4F0} Article Extractor Initialized");chrome.runtime.onMessage.addListener((o,i,l)=>{if(console.log("Message received in content script:",o),o.action==="EXTRACT_ARTICLE")return u().then(e=>{console.log("Extracted article data:",e),l(e)}),!0});async function u(){function o(t){if(!t)return"";let n=t.cloneNode(!0);return n.querySelectorAll("script, style, nav, header, footer, .ad, .advertisement").forEach(r=>r.remove()),n.innerText.trim()}function i(){let t=[];return document.querySelectorAll("iframe").forEach(n=>{try{let c=n.getAttribute("src");if(c&&c.includes("disqus.com")){console.warn("Skipping Disqus iframe due to cross-origin restrictions.");return}let r=n.contentDocument||n.contentWindow.document;if(r){let s=r.querySelector(".article-list-article, article, .article-content");if(s)t.push(o(s));else{let a=o(r.body);a.length>100&&t.push(a)}}}catch(c){console.warn("Could not access iframe:",c)}}),t.join(`

`)}let l=[".article-list-article","article",".article-content",".story-content",'div[class*="article"]','div[class*="story"]',".entry-content","main",'div[role="main"]'],e="";for(let t of l){let n=document.querySelector(t);if(n){if(e=o(n),console.log(`Found content using selector: ${t}, Content Length: ${e.length}`),e.length>100){console.log(`Valid content found: ${e.slice(0,200)}...`);break}}else console.log(`No content found for selector: ${t}`)}if((!e||e.length<100)&&(console.log("Checking iframes for content..."),e=i(),console.log(`Iframes content length: ${e.length}`)),!e.trim())throw new Error("No article content found. Please make sure you're on an article page.");return console.log("Content extraction stats:",{totalLength:e.length,preview:e.slice(0,200)+"...",estimatedTokens:Math.ceil(e.length/4)}),{title:document.title,text:e}}})();
